version: "3.9"
networks:
  Auth:
  driver: bridge

services:
  app:
    container_name: Auth
    build:
    dockerfile: Dockerfile
  prots:
    - "${PORT}:${PORT}"
  volumes:
    - /logs:/var/log/services

postgres:
  image: postgres:16
  environment:
    POSTGRES_DB: ${DB_NAME}
    POSTGRES_USER: ${DB_USER}
    POSTGRES_PASSWORD: ${DB_PASS}
  ports:
    - "${DB_PORT}:${DB_PORT}"
  volumes:
    - ./postgres-data:/var/lib/postgresql/auth/data

migrate:
  image: migrate/migrate

  depends_on:
    - postgres

  volumes:
    - /scheme:/migrations

  command: [ "-path", "/migrations", "-database", "postgres://$${DB_USER}:$${DB_PASS}@$${HOST}:$${DB_PORT}/$${DB_NAME}?sslmode=$${SSL_MODE}", "up" ]
